<!DOCTYPE html>

<html>
<head>
  <title>jquery.bbq.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="about.controller.html">
                about.controller.js
              </a>
            
              
              <a class="source" href="about.html.html">
                about.html.js
              </a>
            
              
              <a class="source" href="about.html">
                about.js
              </a>
            
              
              <a class="source" href="about.html">
                about.js
              </a>
            
              
              <a class="source" href="about.html">
                about.js
              </a>
            
              
              <a class="source" href="addressBook.edit.controller.html">
                addressBook.edit.controller.js
              </a>
            
              
              <a class="source" href="addressBook.edit.html.html">
                addressBook.edit.html.js
              </a>
            
              
              <a class="source" href="addressBook.edit.html">
                addressBook.edit.js
              </a>
            
              
              <a class="source" href="addressBook.edit.html">
                addressBook.edit.js
              </a>
            
              
              <a class="source" href="addressBook.edit.html">
                addressBook.edit.js
              </a>
            
              
              <a class="source" href="addressBook.list.controller.html">
                addressBook.list.controller.js
              </a>
            
              
              <a class="source" href="addressBook.list.html.html">
                addressBook.list.html.js
              </a>
            
              
              <a class="source" href="addressBook.list.html">
                addressBook.list.js
              </a>
            
              
              <a class="source" href="addressBook.list.html">
                addressBook.list.js
              </a>
            
              
              <a class="source" href="addressBook.list.html">
                addressBook.list.js
              </a>
            
              
              <a class="source" href="all.html">
                all.js
              </a>
            
              
              <a class="source" href="browser.banner.html">
                browser.banner.js
              </a>
            
              
              <a class="source" href="home.controller.html">
                home.controller.js
              </a>
            
              
              <a class="source" href="home.html.html">
                home.html.js
              </a>
            
              
              <a class="source" href="home.html">
                home.js
              </a>
            
              
              <a class="source" href="home.html">
                home.js
              </a>
            
              
              <a class="source" href="home.html">
                home.js
              </a>
            
              
              <a class="source" href="i18n.html">
                i18n.js
              </a>
            
              
              <a class="source" href="jade.html">
                jade.js
              </a>
            
              
              <a class="source" href="jquery.bbq.html">
                jquery.bbq.js
              </a>
            
              
              <a class="source" href="jquery.migrate.html">
                jquery.migrate.js
              </a>
            
              
              <a class="source" href="json2.html">
                json2.js
              </a>
            
              
              <a class="source" href="language.html">
                language.js
              </a>
            
              
              <a class="source" href="layout.default.controller.html">
                layout.default.controller.js
              </a>
            
              
              <a class="source" href="layout.default.html.html">
                layout.default.html.js
              </a>
            
              
              <a class="source" href="layout.default.html">
                layout.default.js
              </a>
            
              
              <a class="source" href="layout.footer.controller.html">
                layout.footer.controller.js
              </a>
            
              
              <a class="source" href="layout.footer.html.html">
                layout.footer.html.js
              </a>
            
              
              <a class="source" href="layout.footer.html">
                layout.footer.js
              </a>
            
              
              <a class="source" href="layout.header.controller.html">
                layout.header.controller.js
              </a>
            
              
              <a class="source" href="layout.header.html.html">
                layout.header.html.js
              </a>
            
              
              <a class="source" href="layout.header.html">
                layout.header.js
              </a>
            
              
              <a class="source" href="layout.header.html">
                layout.header.js
              </a>
            
              
              <a class="source" href="layout.header.html">
                layout.header.js
              </a>
            
              
              <a class="source" href="layout.simple.controller.html">
                layout.simple.controller.js
              </a>
            
              
              <a class="source" href="layout.simple.html.html">
                layout.simple.html.js
              </a>
            
              
              <a class="source" href="layout.simple.html">
                layout.simple.js
              </a>
            
              
              <a class="source" href="log.html">
                log.js
              </a>
            
              
              <a class="source" href="moment.html">
                moment.js
              </a>
            
              
              <a class="source" href="multitracker.html">
                multitracker.js
              </a>
            
              
              <a class="source" href="myServices.controller.html">
                myServices.controller.js
              </a>
            
              
              <a class="source" href="myServices.html.html">
                myServices.html.js
              </a>
            
              
              <a class="source" href="myServices.html">
                myServices.js
              </a>
            
              
              <a class="source" href="myServices.html">
                myServices.js
              </a>
            
              
              <a class="source" href="moment.lang.html">
                moment.lang.js
              </a>
            
              
              <a class="source" href="moment.lang.html">
                moment.lang.js
              </a>
            
              
              <a class="source" href="require.config.html">
                require.config.js
              </a>
            
              
              <a class="source" href="require.html">
                require.js
              </a>
            
              
              <a class="source" href="service.list.html">
                service.list.js
              </a>
            
              
              <a class="source" href="service.list.controller.html">
                service.list.controller.js
              </a>
            
              
              <a class="source" href="service.list.html.html">
                service.list.html.js
              </a>
            
              
              <a class="source" href="service.thumb.html">
                service.thumb.js
              </a>
            
              
              <a class="source" href="service.thumb.controller.html">
                service.thumb.controller.js
              </a>
            
              
              <a class="source" href="service.thumb.html.html">
                service.thumb.html.js
              </a>
            
              
              <a class="source" href="serviceCatalog.html">
                serviceCatalog.js
              </a>
            
              
              <a class="source" href="serviceCatalog.html">
                serviceCatalog.js
              </a>
            
              
              <a class="source" href="serviceCatalog.html">
                serviceCatalog.js
              </a>
            
              
              <a class="source" href="serviceCatalog.controller.html">
                serviceCatalog.controller.js
              </a>
            
              
              <a class="source" href="serviceCatalog.html.html">
                serviceCatalog.html.js
              </a>
            
              
              <a class="source" href="serviceDetail.html">
                serviceDetail.js
              </a>
            
              
              <a class="source" href="serviceDetail.html">
                serviceDetail.js
              </a>
            
              
              <a class="source" href="serviceDetail.html">
                serviceDetail.js
              </a>
            
              
              <a class="source" href="serviceDetail.controller.html">
                serviceDetail.controller.js
              </a>
            
              
              <a class="source" href="serviceDetail.html.html">
                serviceDetail.html.js
              </a>
            
              
              <a class="source" href="servicePlan.html">
                servicePlan.js
              </a>
            
              
              <a class="source" href="servicePlan.html">
                servicePlan.js
              </a>
            
              
              <a class="source" href="servicePlan.html">
                servicePlan.js
              </a>
            
              
              <a class="source" href="servicePlan.controller.html">
                servicePlan.controller.js
              </a>
            
              
              <a class="source" href="servicePlan.html.html">
                servicePlan.html.js
              </a>
            
              
              <a class="source" href="settings.html">
                settings.js
              </a>
            
              
              <a class="source" href="sideBar.html">
                sideBar.js
              </a>
            
              
              <a class="source" href="sideBar.html">
                sideBar.js
              </a>
            
              
              <a class="source" href="sideBar.html">
                sideBar.js
              </a>
            
              
              <a class="source" href="sideBar.controller.html">
                sideBar.controller.js
              </a>
            
              
              <a class="source" href="sideBar.html.html">
                sideBar.html.js
              </a>
            
              
              <a class="source" href="tmpst.html">
                tmpst.js
              </a>
            
              
              <a class="source" href="useragent.html">
                useragent.js
              </a>
            
              
              <a class="source" href="all.html">
                all.js
              </a>
            
              
              <a class="source" href="dash.html">
                dash.js
              </a>
            
              
              <a class="source" href="serviceModal.html">
                serviceModal.js
              </a>
            
              
              <a class="source" href="about.html">
                about.js
              </a>
            
              
              <a class="source" href="addressBook.html">
                addressBook.js
              </a>
            
              
              <a class="source" href="all.html">
                all.js
              </a>
            
              
              <a class="source" href="home.html">
                home.js
              </a>
            
              
              <a class="source" href="my.services.html">
                my.services.js
              </a>
            
              
              <a class="source" href="serviceDetail.html">
                serviceDetail.js
              </a>
            
              
              <a class="source" href="services.html">
                services.js
              </a>
            
              
              <a class="source" href="all.html">
                all.js
              </a>
            
              
              <a class="source" href="onLastRepeat.html">
                onLastRepeat.js
              </a>
            
              
              <a class="source" href="vm.component.html">
                vm.component.js
              </a>
            
              
              <a class="source" href="vm.errorPanel.html">
                vm.errorPanel.js
              </a>
            
              
              <a class="source" href="vm.parser.html">
                vm.parser.js
              </a>
            
              
              <a class="source" href="addressBookModel.html">
                addressBookModel.js
              </a>
            
              
              <a class="source" href="all.html">
                all.js
              </a>
            
              
              <a class="source" href="errorHttpInterceptor.html">
                errorHttpInterceptor.js
              </a>
            
              
              <a class="source" href="errorService.html">
                errorService.js
              </a>
            
              
              <a class="source" href="filterService.html">
                filterService.js
              </a>
            
              
              <a class="source" href="jsonHttpInterceptor.html">
                jsonHttpInterceptor.js
              </a>
            
              
              <a class="source" href="serviceModel.html">
                serviceModel.js
              </a>
            
              
              <a class="source" href="servicePlanModel.html">
                servicePlanModel.js
              </a>
            
              
              <a class="source" href="sideBarModel.html">
                sideBarModel.js
              </a>
            
              
              <a class="source" href="all.html">
                all.js
              </a>
            
              
              <a class="source" href="dash.html">
                dash.js
              </a>
            
              
              <a class="source" href="all.html">
                all.js
              </a>
            
              
              <a class="source" href="errorPanel.html.html">
                errorPanel.html.js
              </a>
            
              
              <a class="source" href="errorPanel.html">
                errorPanel.js
              </a>
            
              
              <a class="source" href="errorPanel.html">
                errorPanel.js
              </a>
            
              
              <a class="source" href="service.modal.html">
                service.modal.js
              </a>
            
              
              <a class="source" href="service.modal.html.html">
                service.modal.html.js
              </a>
            
              
              <a class="source" href="service.modal.html">
                service.modal.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery.bbq.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*!
 * jQuery BBQ: Back Button &amp; Query Library - v1.2.1 - 2/17/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Script: jQuery BBQ: Back Button &amp; Query Library</p>
<p><em>Version: 1.2.1, Last updated: 2/17/2010</em></p>
<p>Project Home - <a href="http://benalman.com/projects/jquery-bbq-plugin/">http://benalman.com/projects/jquery-bbq-plugin/</a>
GitHub       - <a href="http://github.com/cowboy/jquery-bbq/">http://github.com/cowboy/jquery-bbq/</a>
Source       - <a href="http://github.com/cowboy/jquery-bbq/raw/master/jquery.ba-bbq.js">http://github.com/cowboy/jquery-bbq/raw/master/jquery.ba-bbq.js</a>
(Minified)   - <a href="http://github.com/cowboy/jquery-bbq/raw/master/jquery.ba-bbq.min.js">http://github.com/cowboy/jquery-bbq/raw/master/jquery.ba-bbq.min.js</a> (4.0kb)</p>
<p>About: License</p>
<p>Copyright (c) 2010 “Cowboy” Ben Alman,
Dual licensed under the MIT and GPL licenses.
<a href="http://benalman.com/about/license/">http://benalman.com/about/license/</a></p>
<p>About: Examples</p>
<p>These working examples, complete with fully commented code, illustrate a few
ways in which this plugin can be used.</p>
<p>Basic AJAX     - <a href="http://benalman.com/code/projects/jquery-bbq/examples/fragment-basic/">http://benalman.com/code/projects/jquery-bbq/examples/fragment-basic/</a>
Advanced AJAX  - <a href="http://benalman.com/code/projects/jquery-bbq/examples/fragment-advanced/">http://benalman.com/code/projects/jquery-bbq/examples/fragment-advanced/</a>
jQuery UI Tabs - <a href="http://benalman.com/code/projects/jquery-bbq/examples/fragment-jquery-ui-tabs/">http://benalman.com/code/projects/jquery-bbq/examples/fragment-jquery-ui-tabs/</a>
Deparam        - <a href="http://benalman.com/code/projects/jquery-bbq/examples/deparam/">http://benalman.com/code/projects/jquery-bbq/examples/deparam/</a></p>
<p>About: Support and Testing</p>
<p>Information about what version or versions of jQuery this plugin has been
tested with, what browsers it has been tested in, and where the unit tests
reside (so you can test it yourself).</p>
<p>jQuery Versions - 1.3.2, 1.4.1, 1.4.2
Browsers Tested - Internet Explorer 6-8, Firefox 2-3.7, Safari 3-4,
                  Chrome 4-5, Opera 9.6-10.1.
Unit Tests      - <a href="http://benalman.com/code/projects/jquery-bbq/unit/">http://benalman.com/code/projects/jquery-bbq/unit/</a></p>
<p>About: Release History</p>
<p>1.2.1 - (2/17/2010) Actually fixed the stale window.location Safari bug from
        <jQuery hashchange event> in BBQ, which was the main reason for the
        previous release!
1.2   - (2/16/2010) Integrated <jQuery hashchange event> v1.2, which fixes a
        Safari bug, the event can now be bound before DOM ready, and IE6/7
        page should no longer scroll when the event is first bound. Also
        added the <jQuery.param.fragment.noEscape> method, and reworked the
        <hashchange event (BBQ)> internal “add” method to be compatible with
        changes made to the jQuery 1.4.2 special events API.
1.1.1 - (1/22/2010) Integrated <jQuery hashchange event> v1.1, which fixes an
        obscure IE8 EmulateIE7 meta tag compatibility mode bug.
1.1   - (1/9/2010) Broke out the jQuery BBQ event.special <hashchange event>
        functionality into a separate plugin for users who want just the
        basic event &amp; back button support, without all the extra awesomeness
        that BBQ provides. This plugin will be included as part of jQuery BBQ,
        but also be available separately. See <jQuery hashchange event>
        plugin for more information. Also added the <jQuery.bbq.removeState>
        method and added additional <jQuery.deparam> examples.
1.0.3 - (12/2/2009) Fixed an issue in IE 6 where location.search and
        location.hash would report incorrectly if the hash contained the ?
        character. Also <jQuery.param.querystring> and <jQuery.param.fragment>
        will no longer parse params out of a URL that doesn’t contain ? or #,
        respectively.
1.0.2 - (10/10/2009) Fixed an issue in IE 6/7 where the hidden IFRAME caused
        a “This page contains both secure and nonsecure items.” warning when
        used on an https:// page.
1.0.1 - (10/7/2009) Fixed an issue in IE 8. Since both “IE7” and “IE8
        Compatibility View” modes erroneously report that the browser
        supports the native window.onhashchange event, a slightly more
        robust test needed to be added.
1.0   - (10/2/2009) Initial release</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$, window</span>) </span>{
  <span class="hljs-string">'$:nomunge'</span>; <span class="hljs-comment">// Used by YUI compressor.</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Some convenient shortcuts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> <span class="hljs-literal">undefined</span>,
    aps = <span class="hljs-built_in">Array</span>.prototype.slice,
    decode = <span class="hljs-built_in">decodeURIComponent</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Method / object references.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    jq_param = $.param,
    jq_param_fragment,
    jq_deparam,
    jq_deparam_fragment,
    jq_bbq = $.bbq = $.bbq || {},
    jq_bbq_pushState,
    jq_bbq_getState,
    jq_elemUrlAttr,
    jq_event_special = $.event.special,</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Reused strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    str_hashchange = <span class="hljs-string">'hashchange'</span>,
    str_querystring = <span class="hljs-string">'querystring'</span>,
    str_fragment = <span class="hljs-string">'fragment'</span>,
    str_elemUrlAttr = <span class="hljs-string">'elemUrlAttr'</span>,
    str_location = <span class="hljs-string">'location'</span>,
    str_href = <span class="hljs-string">'href'</span>,
    str_src = <span class="hljs-string">'src'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Reused RegExp.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    re_trim_querystring = <span class="hljs-regexp">/^.*\?|#.*$/g</span>,
    re_trim_fragment = <span class="hljs-regexp">/^.*\#/</span>,
    re_no_escape,</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Used by jQuery.elemUrlAttr.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    elemUrlAttr_cache = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>A few commonly used bits, broken out to help reduce minified file size.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_string</span>(<span class="hljs-params">arg</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> arg === <span class="hljs-string">'string'</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Why write the same function twice? Let’s curry! Mmmm, curry..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curry</span>(<span class="hljs-params">func</span>) </span>{
    <span class="hljs-keyword">var</span> args = aps.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> func.apply(<span class="hljs-keyword">this</span>, args.concat(aps.call(<span class="hljs-built_in">arguments</span>)));
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Get location.hash (or what you’d expect location.hash to be) sans any
leading #. Thanks for making this necessary, Firefox!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_fragment</span>(<span class="hljs-params">url</span>) </span>{
    <span class="hljs-keyword">return</span> url.replace(<span class="hljs-regexp">/^[^#]*#?(.*)$/</span>, <span class="hljs-string">'$1'</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Get location.search (or what you’d expect location.search to be) sans any
leading #. Thanks for making this necessary, IE6!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_querystring</span>(<span class="hljs-params">url</span>) </span>{
    <span class="hljs-keyword">return</span> url.replace(<span class="hljs-regexp">/(?:^[^?#]*\?([^#]*).*$)?.*/</span>, <span class="hljs-string">'$1'</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Section: Param (to string)</p>
<p>Method: jQuery.param.querystring</p>
<p>Retrieve the query string from a URL or if no arguments are passed, the
current window.location.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.param.querystring( [ url ] );</p>
</blockquote>
<p>Arguments:</p>
<p> url - (String) A URL containing query string params to be parsed. If url
   is not passed, the current window.location is used.</p>
<p>Returns:</p>
<p> (String) The parsed query string, with any leading “?” removed.</p>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Method: jQuery.param.querystring (build url)</p>
<p>Merge a URL, with or without pre-existing query string params, plus any
object, params string or URL containing query string params into a new URL.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.param.querystring( url, params [, merge_mode ] );</p>
</blockquote>
<p>Arguments:</p>
<p> url - (String) A valid URL for params to be merged into. This URL may
   contain a query string and/or fragment (hash).
 params - (String) A params string or URL containing query string params to
   be merged into url.
 params - (Object) A params object to be merged into url.
 merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
   specified, and is as-follows:</p>
<ul>
<li>0: params in the params argument will override any query string
   params in url.</li>
<li>1: any query string params in url will override params in the params
   argument.</li>
<li>2: params argument will completely replace any query string in url.</li>
</ul>
<p>Returns:</p>
<p> (String) Either a params string with urlencoded data or a URL with a
   urlencoded query string in the format ‘a=b&amp;c=d&amp;e=f’.</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Method: jQuery.param.fragment</p>
<p>Retrieve the fragment (hash) from a URL or if no arguments are passed, the
current window.location.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.param.fragment( [ url ] );</p>
</blockquote>
<p>Arguments:</p>
<p> url - (String) A URL containing fragment (hash) params to be parsed. If
   url is not passed, the current window.location is used.</p>
<p>Returns:</p>
<p> (String) The parsed fragment (hash) string, with any leading “#” removed.</p>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Method: jQuery.param.fragment (build url)</p>
<p>Merge a URL, with or without pre-existing fragment (hash) params, plus any
object, params string or URL containing fragment (hash) params into a new
URL.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.param.fragment( url, params [, merge_mode ] );</p>
</blockquote>
<p>Arguments:</p>
<p> url - (String) A valid URL for params to be merged into. This URL may
   contain a query string and/or fragment (hash).
 params - (String) A params string or URL containing fragment (hash) params
   to be merged into url.
 params - (Object) A params object to be merged into url.
 merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
   specified, and is as-follows:</p>
<ul>
<li>0: params in the params argument will override any fragment (hash)
   params in url.</li>
<li>1: any fragment (hash) params in url will override params in the
   params argument.</li>
<li>2: params argument will completely replace any query string in url.</li>
</ul>
<p>Returns:</p>
<p> (String) Either a params string with urlencoded data or a URL with a
   urlencoded fragment (hash) in the format ‘a=b&amp;c=d&amp;e=f’.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jq_param_sub</span>(<span class="hljs-params">is_fragment, get_func, url, params, merge_mode</span>) </span>{
    <span class="hljs-keyword">var</span> result,
      qs,
      matches,
      url_params,
      hash;

    <span class="hljs-keyword">if</span> (params !== <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Build URL by merging params into url string.</p>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>matches[1] = url part that precedes params, not including trailing ?/#
matches[2] = params, not including leading ?/#
matches[3] = if in ‘querystring’ mode, hash including leading #, otherwise ‘’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      matches = url.match(is_fragment ? <span class="hljs-regexp">/^([^#]*)\#?(.*)$/</span> : <span class="hljs-regexp">/^([^#?]*)\??([^#]*)(#?.*)/</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Get the hash if in ‘querystring’ mode, and it exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      hash = matches[<span class="hljs-number">3</span>] || <span class="hljs-string">''</span>;

      <span class="hljs-keyword">if</span> (merge_mode === <span class="hljs-number">2</span> &amp;&amp; is_string(params)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>If merge_mode is 2 and params is a string, merge the fragment / query
string into the URL wholesale, without converting it into an object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        qs = params.replace(is_fragment ? re_trim_fragment : re_trim_querystring, <span class="hljs-string">''</span>);

      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Convert relevant params in url to object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        url_params = jq_deparam(matches[<span class="hljs-number">2</span>]);

        params = is_string(params)</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Convert passed params string into object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        ? jq_deparam[is_fragment ? str_fragment : str_querystring](params)</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Passed params object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        : params;

        qs = merge_mode === <span class="hljs-number">2</span> ? params <span class="hljs-comment">// passed params replace url params</span>
        : merge_mode === <span class="hljs-number">1</span> ? $.extend({}, params, url_params) <span class="hljs-comment">// url params override passed params</span>
        : $.extend({}, url_params, params); <span class="hljs-comment">// passed params override url params</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Convert params object to a string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        qs = jq_param(qs);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Unescape characters specified via $.param.noEscape. Since only hash-
history users have requested this feature, it’s only enabled for
fragment-related params strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (is_fragment) {
          qs = qs.replace(re_no_escape, decode);
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Build URL from the base url, querystring and hash. In ‘querystring’
mode, ? is only added if a query string exists. In ‘fragment’ mode, #
is always added.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      result = matches[<span class="hljs-number">1</span>] + (is_fragment ? <span class="hljs-string">'#'</span> : qs || !matches[<span class="hljs-number">1</span>] ? <span class="hljs-string">'?'</span> : <span class="hljs-string">''</span>) + qs + hash;

    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>If URL was passed in, parse params from URL string, otherwise parse
params from window.location.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      result = get_func(url !== <span class="hljs-literal">undefined</span> ? url : <span class="hljs-built_in">window</span>[str_location][str_href]);
    }

    <span class="hljs-keyword">return</span> result;
  };

  jq_param[str_querystring] = curry(jq_param_sub, <span class="hljs-number">0</span>, get_querystring);
  jq_param[str_fragment] = jq_param_fragment = curry(jq_param_sub, <span class="hljs-number">1</span>, get_fragment);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Method: jQuery.param.fragment.noEscape</p>
<p>Specify characters that will be left unescaped when fragments are created
or merged using <jQuery.param.fragment>, or when the fragment is modified
using <jQuery.bbq.pushState>. This option only applies to serialized data
object fragments, and not set-as-string fragments. Does not affect the
query string. Defaults to “,/“ (comma, forward slash).</p>
<p>Note that this is considered a purely aesthetic option, and will help to
create URLs that “look pretty” in the address bar or bookmarks, without
affecting functionality in any way. That being said, be careful to not
unescape characters that are used as delimiters or serve a special
purpose, such as the “#?&amp;=+” (octothorpe, question mark, ampersand,
equals, plus) characters.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.param.fragment.noEscape( [ chars ] );</p>
</blockquote>
<p>Arguments:</p>
<p> chars - (String) The characters to not escape in the fragment. If
   unspecified, defaults to empty string (escape all characters).</p>
<p>Returns:</p>
<p> Nothing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  jq_param_fragment.noEscape = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chars</span>) </span>{
    chars = chars || <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> arr = $.map(chars.split(<span class="hljs-string">''</span>), <span class="hljs-built_in">encodeURIComponent</span>);
    re_no_escape = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(arr.join(<span class="hljs-string">'|'</span>), <span class="hljs-string">'g'</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>A sensible default. These are the characters people seem to complain about
“uglifying up the URL” the most.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  jq_param_fragment.noEscape(<span class="hljs-string">',/'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Section: Deparam (from string)</p>
<p>Method: jQuery.deparam</p>
<p>Deserialize a params string into an object, optionally coercing numbers,
booleans, null and undefined values; this method is the counterpart to the
internal jQuery.param method.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.deparam( params [, coerce ] );</p>
</blockquote>
<p>Arguments:</p>
<p> params - (String) A params string to be parsed.
 coerce - (Boolean) If true, coerces any numbers or true, false, null, and
   undefined to their actual value. Defaults to false if omitted.</p>
<p>Returns:</p>
<p> (Object) An object representing the deserialized params string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  $.deparam = jq_deparam = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">params, coerce</span>) </span>{
    <span class="hljs-keyword">var</span> obj = {},
      coerce_types = {
        <span class="hljs-string">'true'</span>: !<span class="hljs-number">0</span>,
        <span class="hljs-string">'false'</span>: !<span class="hljs-number">1</span>,
        <span class="hljs-string">'null'</span>: <span class="hljs-literal">null</span>
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Iterate over all name=value pairs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.each(params.replace(<span class="hljs-regexp">/\+/g</span>, <span class="hljs-string">' '</span>).split(<span class="hljs-string">'&amp;'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">j, v</span>) </span>{
      <span class="hljs-keyword">var</span> param = v.split(<span class="hljs-string">'='</span>),
        key = decode(param[<span class="hljs-number">0</span>]),
        val,
        cur = obj,
        i = <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>If key is more complex than ‘foo’, like ‘a[]’ or ‘a[b][c]’, split it
into its component parts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        keys = key.split(<span class="hljs-string">']['</span>),
        keys_last = keys.length - <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>If the first keys part contains [ and the last ends with ], then []
are correctly balanced.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\[/</span>.test(keys[<span class="hljs-number">0</span>]) &amp;&amp; <span class="hljs-regexp">/\]$/</span>.test(keys[keys_last])) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Remove the trailing ] from the last keys part.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        keys[keys_last] = keys[keys_last].replace(<span class="hljs-regexp">/\]$/</span>, <span class="hljs-string">''</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Split first keys part into two parts on the [ and add them back onto
the beginning of the keys array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        keys = keys.shift().split(<span class="hljs-string">'['</span>).concat(keys);

        keys_last = keys.length - <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Basic ‘foo’ style key.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        keys_last = <span class="hljs-number">0</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Are we dealing with a name=value pair, or just a name?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (param.length === <span class="hljs-number">2</span>) {
        val = decode(param[<span class="hljs-number">1</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Coerce values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (coerce) {
          val = val &amp;&amp; !<span class="hljs-built_in">isNaN</span>(val) ? +val <span class="hljs-comment">// number</span>
          : val === <span class="hljs-string">'undefined'</span> ? <span class="hljs-literal">undefined</span> <span class="hljs-comment">// undefined</span>
          : coerce_types[val] !== <span class="hljs-literal">undefined</span> ? coerce_types[val] <span class="hljs-comment">// true, false, null</span>
          : val; <span class="hljs-comment">// string</span>
        }

        <span class="hljs-keyword">if</span> (keys_last) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Complex key, build deep object structure based on a few rules:</p>
<ul>
<li>The ‘cur’ pointer starts at the object top-level.</li>
<li>[] = array push (n is set to array length), [n] = array if n is 
numeric, otherwise object.</li>
<li>If at the last keys part, set the value.</li>
<li>For each keys part, if the current level is undefined create an
object or array based on the type of the next keys part.</li>
<li>Move the ‘cur’ pointer to the next level.</li>
<li>Rinse &amp; repeat.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">for</span> (; i &lt;= keys_last; i++) {
            key = keys[i] === <span class="hljs-string">''</span> ? cur.length : keys[i];
            cur = cur[key] = i &lt; keys_last ? cur[key] || (keys[i + <span class="hljs-number">1</span>] &amp;&amp; <span class="hljs-built_in">isNaN</span>(keys[i + <span class="hljs-number">1</span>]) ? {} : []) : val;
          }

        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Simple key, even simpler rules, since only scalars and shallow
arrays are allowed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
          <span class="hljs-keyword">if</span> ($.isArray(obj[key])) {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>val is already an array, so push on the next value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            obj[key].push(val);

          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj[key] !== <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>val isn’t an array, but since a second value has been specified,
convert val into an array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            obj[key] = [obj[key], val];

          } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>val is a scalar.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            obj[key] = val;
          }
        }

      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key) {</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>No value was defined, so set something meaningful.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        obj[key] = coerce ? <span class="hljs-literal">undefined</span> : <span class="hljs-string">''</span>;
      }
    });

    <span class="hljs-keyword">return</span> obj;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Method: jQuery.deparam.querystring</p>
<p>Parse the query string from a URL or the current window.location,
deserializing it into an object, optionally coercing numbers, booleans,
null and undefined values.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.deparam.querystring( [ url ] [, coerce ] );</p>
</blockquote>
<p>Arguments:</p>
<p> url - (String) An optional params string or URL containing query string
   params to be parsed. If url is omitted, the current window.location
   is used.
 coerce - (Boolean) If true, coerces any numbers or true, false, null, and
   undefined to their actual value. Defaults to false if omitted.</p>
<p>Returns:</p>
<p> (Object) An object representing the deserialized params string.</p>

            </div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Method: jQuery.deparam.fragment</p>
<p>Parse the fragment (hash) from a URL or the current window.location,
deserializing it into an object, optionally coercing numbers, booleans,
null and undefined values.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.deparam.fragment( [ url ] [, coerce ] );</p>
</blockquote>
<p>Arguments:</p>
<p> url - (String) An optional params string or URL containing fragment (hash)
   params to be parsed. If url is omitted, the current window.location
   is used.
 coerce - (Boolean) If true, coerces any numbers or true, false, null, and
   undefined to their actual value. Defaults to false if omitted.</p>
<p>Returns:</p>
<p> (Object) An object representing the deserialized params string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jq_deparam_sub</span>(<span class="hljs-params">is_fragment, url_or_params, coerce</span>) </span>{
    <span class="hljs-keyword">if</span> (url_or_params === <span class="hljs-literal">undefined</span> || <span class="hljs-keyword">typeof</span> url_or_params === <span class="hljs-string">'boolean'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>url_or_params not specified.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      coerce = url_or_params;
      url_or_params = jq_param[is_fragment ? str_fragment : str_querystring]();
    } <span class="hljs-keyword">else</span> {
      url_or_params = is_string(url_or_params) ? url_or_params.replace(is_fragment ? re_trim_fragment : re_trim_querystring, <span class="hljs-string">''</span>) : url_or_params;
    }

    <span class="hljs-keyword">return</span> jq_deparam(url_or_params, coerce);
  };

  jq_deparam[str_querystring] = curry(jq_deparam_sub, <span class="hljs-number">0</span>);
  jq_deparam[str_fragment] = jq_deparam_fragment = curry(jq_deparam_sub, <span class="hljs-number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Section: Element manipulation</p>
<p>Method: jQuery.elemUrlAttr</p>
<p>Get the internal “Default URL attribute per tag” list, or augment the list
with additional tag-attribute pairs, in case the defaults are insufficient.</p>
<p>In the <jQuery.fn.querystring> and <jQuery.fn.fragment> methods, this list
is used to determine which attribute contains the URL to be modified, if
an “attr” param is not specified.</p>
<p>Default Tag-Attribute List:</p>
<p> a      - href
 base   - href
 iframe - src
 img    - src
 input  - src
 form   - action
 link   - href
 script - src</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.elemUrlAttr( [ tag_attr ] );</p>
</blockquote>
<p>Arguments:</p>
<p> tag_attr - (Object) An object containing a list of tag names and their
   associated default attribute names in the format { tag: ‘attr’, … } to
   be merged into the internal tag-attribute list.</p>
<p>Returns:</p>
<p> (Object) An object containing all stored tag-attribute values.</p>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Only define function and set defaults if function doesn’t already exist, as
the urlInternal plugin will provide this method as well.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $[str_elemUrlAttr] || ($[str_elemUrlAttr] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">return</span> $.extend(elemUrlAttr_cache, obj);
  })({
    a: str_href,
    base: str_href,
    iframe: str_src,
    img: str_src,
    input: str_src,
    form: <span class="hljs-string">'action'</span>,
    link: str_href,
    script: str_src
  });

  jq_elemUrlAttr = $[str_elemUrlAttr];</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Method: jQuery.fn.querystring</p>
<p>Update URL attribute in one or more elements, merging the current URL (with
or without pre-existing query string params) plus any params object or
string into a new URL, which is then set into that attribute. Like</p>
<p><jQuery.param.querystring (build url)>, but for all elements in a jQuery
collection.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery(‘selector’).querystring( [ attr, ] params [, merge_mode ] );</p>
</blockquote>
<p>Arguments:</p>
<p> attr - (String) Optional name of an attribute that will contain a URL to
   merge params or url into. See <jQuery.elemUrlAttr> for a list of default
   attributes.
 params - (Object) A params object to be merged into the URL attribute.
 params - (String) A URL containing query string params, or params string
   to be merged into the URL attribute.
 merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
   specified, and is as-follows:</p>
<ul>
<li>0: params in the params argument will override any params in attr URL.</li>
<li>1: any params in attr URL will override params in the params argument.</li>
<li>2: params argument will completely replace any query string in attr
   URL.</li>
</ul>
<p>Returns:</p>
<p> (jQuery) The initial jQuery collection of elements, but with modified URL
 attribute values.</p>

            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Method: jQuery.fn.fragment</p>
<p>Update URL attribute in one or more elements, merging the current URL (with
or without pre-existing fragment/hash params) plus any params object or
string into a new URL, which is then set into that attribute. Like</p>
<p><jQuery.param.fragment (build url)>, but for all elements in a jQuery
collection.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery(‘selector’).fragment( [ attr, ] params [, merge_mode ] );</p>
</blockquote>
<p>Arguments:</p>
<p> attr - (String) Optional name of an attribute that will contain a URL to
   merge params into. See <jQuery.elemUrlAttr> for a list of default
   attributes.
 params - (Object) A params object to be merged into the URL attribute.
 params - (String) A URL containing fragment (hash) params, or params
   string to be merged into the URL attribute.
 merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
   specified, and is as-follows:</p>
<ul>
<li>0: params in the params argument will override any params in attr URL.</li>
<li>1: any params in attr URL will override params in the params argument.</li>
<li>2: params argument will completely replace any fragment (hash) in attr
   URL.</li>
</ul>
<p>Returns:</p>
<p> (jQuery) The initial jQuery collection of elements, but with modified URL
 attribute values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jq_fn_sub</span>(<span class="hljs-params">mode, force_attr, params, merge_mode</span>) </span>{
    <span class="hljs-keyword">if</span> (!is_string(params) &amp;&amp; <span class="hljs-keyword">typeof</span> params !== <span class="hljs-string">'object'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>force_attr not specified.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      merge_mode = params;
      params = force_attr;
      force_attr = <span class="hljs-literal">undefined</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> that = $(<span class="hljs-keyword">this</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Get attribute specified, or default specified via $.elemUrlAttr.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        attr = force_attr || jq_elemUrlAttr()[(<span class="hljs-keyword">this</span>.nodeName || <span class="hljs-string">''</span>).toLowerCase()] || <span class="hljs-string">''</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Get URL value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        url = attr &amp;&amp; that.attr(attr) || <span class="hljs-string">''</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Update attribute with new URL.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      that.attr(attr, jq_param[mode](url, params, merge_mode));
    });

  };

  $.fn[str_querystring] = curry(jq_fn_sub, str_querystring);
  $.fn[str_fragment] = curry(jq_fn_sub, str_fragment);</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Section: History, hashchange event</p>
<p>Method: jQuery.bbq.pushState</p>
<p>Adds a ‘state’ into the browser history at the current position, setting
location.hash and triggering any bound <hashchange event> callbacks
(provided the new state is different than the previous state).</p>
<p>If no arguments are passed, an empty state is created, which is just a
shortcut for jQuery.bbq.pushState( {}, 2 ).</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.bbq.pushState( [ params [, merge_mode ] ] );</p>
</blockquote>
<p>Arguments:</p>
<p> params - (String) A serialized params string or a hash string beginning
   with # to merge into location.hash.
 params - (Object) A params object to merge into location.hash.
 merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
   specified (unless a hash string beginning with # is specified, in which
   case merge behavior defaults to 2), and is as-follows:</p>
<ul>
<li>0: params in the params argument will override any params in the
   current state.</li>
<li>1: any params in the current state will override params in the params
   argument.</li>
<li>2: params argument will completely replace current state.</li>
</ul>
<p>Returns:</p>
<p> Nothing.</p>
<p>Additional Notes:</p>
<ul>
<li>Setting an empty state may cause the browser to scroll.</li>
<li>Unlike the fragment and querystring methods, if a hash string beginning
with # is specified as the params agrument, merge_mode defaults to 2.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  jq_bbq.pushState = jq_bbq_pushState = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">params, merge_mode</span>) </span>{
    <span class="hljs-keyword">if</span> (is_string(params) &amp;&amp; <span class="hljs-regexp">/^#/</span>.test(params) &amp;&amp; merge_mode === <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Params string begins with # and merge_mode not specified, so completely
overwrite window.location.hash.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      merge_mode = <span class="hljs-number">2</span>;
    }

    <span class="hljs-keyword">var</span> has_args = params !== <span class="hljs-literal">undefined</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Merge params into window.location using $.param.fragment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      url = jq_param_fragment(<span class="hljs-built_in">window</span>[str_location][str_href],
        has_args ? params : {}, has_args ? merge_mode : <span class="hljs-number">2</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Set new window.location.href. If hash is empty, use just # to prevent
browser from reloading the page. Note that Safari 3 &amp; Chrome barf on
location.hash = ‘#’.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">window</span>[str_location][str_href] = url + (<span class="hljs-regexp">/#/</span>.test(url) ? <span class="hljs-string">''</span> : <span class="hljs-string">'#'</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Method: jQuery.bbq.getState</p>
<p>Retrieves the current ‘state’ from the browser history, parsing
location.hash for a specific key or returning an object containing the
entire state, optionally coercing numbers, booleans, null and undefined
values.</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.bbq.getState( [ key ] [, coerce ] );</p>
</blockquote>
<p>Arguments:</p>
<p> key - (String) An optional state key for which to return a value.
 coerce - (Boolean) If true, coerces any numbers or true, false, null, and
   undefined to their actual value. Defaults to false.</p>
<p>Returns:</p>
<p> (Anything) If key is passed, returns the value corresponding with that key
   in the location.hash ‘state’, or undefined. If not, an object
   representing the entire ‘state’ is returned.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  jq_bbq.getState = jq_bbq_getState = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, coerce</span>) </span>{
    <span class="hljs-keyword">return</span> key === <span class="hljs-literal">undefined</span> || <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'boolean'</span> ? jq_deparam_fragment(key) <span class="hljs-comment">// 'key' really means 'coerce' here</span>
      : jq_deparam_fragment(coerce)[key];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Method: jQuery.bbq.removeState</p>
<p>Remove one or more keys from the current browser history ‘state’, creating
a new state, setting location.hash and triggering any bound</p>
<p><hashchange event> callbacks (provided the new state is different than
the previous state).</p>
<p>If no arguments are passed, an empty state is created, which is just a
shortcut for jQuery.bbq.pushState( {}, 2 ).</p>
<p>Usage:</p>
<blockquote>
<p>jQuery.bbq.removeState( [ key [, key … ] ] );</p>
</blockquote>
<p>Arguments:</p>
<p> key - (String) One or more key values to remove from the current state,
   passed as individual arguments.
 key - (Array) A single array argument that contains a list of key values
   to remove from the current state.</p>
<p>Returns:</p>
<p> Nothing.</p>
<p>Additional Notes:</p>
<ul>
<li>Setting an empty state may cause the browser to scroll.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  jq_bbq.removeState = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arr</span>) </span>{
    <span class="hljs-keyword">var</span> state = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>If one or more arguments is passed..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (arr !== <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Get the current state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      state = jq_bbq_getState();</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>For each passed key, delete the corresponding property from the current
state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.each($.isArray(arr) ? arr : <span class="hljs-built_in">arguments</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i, v</span>) </span>{
        <span class="hljs-keyword">delete</span> state[v];
      });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Set the state, completely overriding any existing state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    jq_bbq_pushState(state, <span class="hljs-number">2</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Event: hashchange event (BBQ)</p>
<p>Usage in jQuery 1.4 and newer:</p>
<p>In jQuery 1.4 and newer, the event object passed into any hashchange event
callback is augmented with a copy of the location.hash fragment at the time
the event was triggered as its event.fragment property. In addition, the
event.getState method operates on this property (instead of location.hash)
which allows this fragment-as-a-state to be referenced later, even after
window.location may have changed.</p>
<p>Note that event.fragment and event.getState are not defined according to
W3C (or any other) specification, but will still be available whether or
not the hashchange event exists natively in the browser, because of the
utility they provide.</p>
<p>The event.fragment property contains the output of <jQuery.param.fragment>
and the event.getState method is equivalent to the <jQuery.bbq.getState>
method.</p>
<blockquote>
<p>$(window).bind( ‘hashchange’, function( event ) {
  var hash_str = event.fragment,
    param_obj = event.getState(),
    param_val = event.getState( ‘param_name’ ),
    param_val_coerced = event.getState( ‘param_name’, true );
  …
});</p>
</blockquote>
<p>Usage in jQuery 1.3.2:</p>
<p>In jQuery 1.3.2, the event object cannot to be augmented as in jQuery 1.4+,
so the fragment state isn’t bound to the event object and must instead be
parsed using the <jQuery.param.fragment> and <jQuery.bbq.getState> methods.</p>
<blockquote>
<p>$(window).bind( ‘hashchange’, function( event ) {
  var hash_str = $.param.fragment(),
    param_obj = $.bbq.getState(),
    param_val = $.bbq.getState( ‘param_name’ ),
    param_val_coerced = $.bbq.getState( ‘param_name’, true );
  …
});</p>
</blockquote>
<p>Additional Notes:</p>
<ul>
<li>Due to changes in the special events API, jQuery BBQ v1.2 or newer is
required to enable the augmented event object in jQuery 1.4.2 and newer.</li>
<li>See <jQuery hashchange event> for more detailed information.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  jq_event_special[str_hashchange] = $.extend(jq_event_special[str_hashchange], {</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Augmenting the event object with the .fragment property and .getState
method requires jQuery 1.4 or newer. Note: with 1.3.2, everything will
work, but the event won’t be augmented)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    add: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">handleObj</span>) </span>{
      <span class="hljs-keyword">var</span> old_handler;

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">new_handler</span>(<span class="hljs-params">e</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>e.fragment is set to the value of location.hash (with any leading #
removed) at the time the event is triggered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> hash = e[str_fragment] = jq_param_fragment();</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>e.getState() works just like $.bbq.getState(), but uses the
e.fragment property stored on the event object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        e.getState = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, coerce</span>) </span>{
          <span class="hljs-keyword">return</span> key === <span class="hljs-literal">undefined</span> || <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'boolean'</span> ? jq_deparam(hash, key) <span class="hljs-comment">// 'key' really means 'coerce' here</span>
            : jq_deparam(hash, coerce)[key];
        };

        old_handler.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>This may seem a little complicated, but it normalizes the special event
.add method between jQuery 1.4/1.4.1 and 1.4.2+</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ($.isFunction(handleObj)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>1.4, 1.4.1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        old_handler = handleObj;
        <span class="hljs-keyword">return</span> new_handler;
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>1.4.2+</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        old_handler = handleObj.handler;
        handleObj.handler = new_handler;
      }
    }

  });

})(jQuery, <span class="hljs-keyword">this</span>);

<span class="hljs-comment">/*!
 * jQuery hashchange event - v1.2 - 2/11/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Script: jQuery hashchange event</p>
<p><em>Version: 1.2, Last updated: 2/11/2010</em></p>
<p>Project Home - <a href="http://benalman.com/projects/jquery-hashchange-plugin/">http://benalman.com/projects/jquery-hashchange-plugin/</a>
GitHub       - <a href="http://github.com/cowboy/jquery-hashchange/">http://github.com/cowboy/jquery-hashchange/</a>
Source       - <a href="http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.js">http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.js</a>
(Minified)   - <a href="http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.min.js">http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.min.js</a> (1.1kb)</p>
<p>About: License</p>
<p>Copyright (c) 2010 “Cowboy” Ben Alman,
Dual licensed under the MIT and GPL licenses.
<a href="http://benalman.com/about/license/">http://benalman.com/about/license/</a></p>
<p>About: Examples</p>
<p>This working example, complete with fully commented code, illustrate one way
in which this plugin can be used.</p>
<p>hashchange event - <a href="http://benalman.com/code/projects/jquery-hashchange/examples/hashchange/">http://benalman.com/code/projects/jquery-hashchange/examples/hashchange/</a></p>
<p>About: Support and Testing</p>
<p>Information about what version or versions of jQuery this plugin has been
tested with, what browsers it has been tested in, and where the unit tests
reside (so you can test it yourself).</p>
<p>jQuery Versions - 1.3.2, 1.4.1, 1.4.2
Browsers Tested - Internet Explorer 6-8, Firefox 2-3.7, Safari 3-4, Chrome, Opera 9.6-10.1.
Unit Tests      - <a href="http://benalman.com/code/projects/jquery-hashchange/unit/">http://benalman.com/code/projects/jquery-hashchange/unit/</a></p>
<p>About: Known issues</p>
<p>While this jQuery hashchange event implementation is quite stable and robust,
there are a few unfortunate browser bugs surrounding expected hashchange
event-based behaviors, independent of any JavaScript window.onhashchange
abstraction. See the following examples for more information:</p>
<p>Chrome: Back Button - <a href="http://benalman.com/code/projects/jquery-hashchange/examples/bug-chrome-back-button/">http://benalman.com/code/projects/jquery-hashchange/examples/bug-chrome-back-button/</a>
Firefox: Remote XMLHttpRequest - <a href="http://benalman.com/code/projects/jquery-hashchange/examples/bug-firefox-remote-xhr/">http://benalman.com/code/projects/jquery-hashchange/examples/bug-firefox-remote-xhr/</a>
WebKit: Back Button in an Iframe - <a href="http://benalman.com/code/projects/jquery-hashchange/examples/bug-webkit-hash-iframe/">http://benalman.com/code/projects/jquery-hashchange/examples/bug-webkit-hash-iframe/</a>
Safari: Back Button from a different domain - <a href="http://benalman.com/code/projects/jquery-hashchange/examples/bug-safari-back-from-diff-domain/">http://benalman.com/code/projects/jquery-hashchange/examples/bug-safari-back-from-diff-domain/</a></p>
<p>About: Release History</p>
<p>1.2   - (2/11/2010) Fixed a bug where coming back to a page using this plugin
        from a page on another domain would cause an error in Safari 4. Also,
        IE6/7 Iframe is now inserted after the body (this actually works),
        which prevents the page from scrolling when the event is first bound.
        Event can also now be bound before DOM ready, but it won’t be usable
        before then in IE6/7.
1.1   - (1/21/2010) Incorporated document.documentMode test to fix IE8 bug
        where browser version is incorrectly reported as 8.0, despite
        inclusion of the X-UA-Compatible IE=EmulateIE7 meta tag.
1.0   - (1/9/2010) Initial Release. Broke out the jQuery BBQ event.special
        window.onhashchange functionality into a separate plugin for users
        who want just the basic event &amp; back button support, without all the
        extra awesomeness that BBQ provides. This plugin will be included as
        part of jQuery BBQ, but also be available separately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$, window, undefined</span>) </span>{
  <span class="hljs-string">'$:nomunge'</span>; <span class="hljs-comment">// Used by YUI compressor.</span></pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Method / object references.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> fake_onhashchange,
    jq_event_special = $.event.special,</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Reused strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    str_location = <span class="hljs-string">'location'</span>,
    str_hashchange = <span class="hljs-string">'hashchange'</span>,
    str_href = <span class="hljs-string">'href'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>IE6/7 specifically need some special love when it comes to back-button
support, so let’s do a little browser sniffing..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    browser = $.browser,
    mode = <span class="hljs-built_in">document</span>.documentMode,
    is_old_ie = browser.msie &amp;&amp; (mode === <span class="hljs-literal">undefined</span> || mode &lt; <span class="hljs-number">8</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Does the browser support window.onhashchange? Test for IE version, since
IE8 incorrectly reports this when in “IE7” or “IE8 Compatibility View”!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    supports_onhashchange = <span class="hljs-string">'on'</span> + str_hashchange <span class="hljs-keyword">in</span> <span class="hljs-built_in">window</span> &amp;&amp; !is_old_ie;</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Get location.hash (or what you’d expect location.hash to be) sans any
leading #. Thanks for making this necessary, Firefox!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_fragment</span>(<span class="hljs-params">url</span>) </span>{
    url = url || <span class="hljs-built_in">window</span>[str_location][str_href];
    <span class="hljs-keyword">return</span> url.replace(<span class="hljs-regexp">/^[^#]*#?(.*)$/</span>, <span class="hljs-string">'$1'</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Property: jQuery.hashchangeDelay</p>
<p>The numeric interval (in milliseconds) at which the <hashchange event>
polling loop executes. Defaults to 100.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  $[str_hashchange + <span class="hljs-string">'Delay'</span>] = <span class="hljs-number">100</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Event: hashchange event</p>
<p>Fired when location.hash changes. In browsers that support it, the native
window.onhashchange event is used (IE8, FF3.6), otherwise a polling loop is
initialized, running every <jQuery.hashchangeDelay> milliseconds to see if
the hash has changed. In IE 6 and 7, a hidden Iframe is created to allow
the back button and hash-based history to work.</p>
<p>Usage:</p>
<blockquote>
<p>$(window).bind( ‘hashchange’, function(e) {
  var hash = location.hash;
  …
});</p>
</blockquote>
<p>Additional Notes:</p>
<ul>
<li>The polling loop and Iframe are not created until at least one callback
is actually bound to ‘hashchange’.</li>
<li>If you need the bound callback(s) to execute immediately, in cases where
the page ‘state’ exists on page load (via bookmark or page refresh, for
example) use $(window).trigger( ‘hashchange’ );</li>
<li>The event can be bound before DOM ready, but since it won’t be usable
before then in IE6/7 (due to the necessary Iframe), recommended usage is
to bind it inside a $(document).ready() callback.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  jq_event_special[str_hashchange] = $.extend(jq_event_special[str_hashchange], {</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Called only when the first ‘hashchange’ event is bound to window.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setup: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>If window.onhashchange is supported natively, there’s nothing to do..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (supports_onhashchange) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Otherwise, we need to create our own. And we don’t want to call this
until the user binds to the event, just in case they never do, since it
will create a polling loop and possibly even a hidden Iframe.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(fake_onhashchange.start);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Called only when the last ‘hashchange’ event is unbound from window.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    teardown: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>If window.onhashchange is supported natively, there’s nothing to do..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (supports_onhashchange) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Otherwise, we need to stop ours (if possible).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(fake_onhashchange.stop);
    }

  });</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>fake_onhashchange does all the work of triggering the window.onhashchange
event for browsers that don’t natively support it, including creating a
polling loop to watch for hash changes and in IE 6/7 creating a hidden
Iframe to enable back and forward.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fake_onhashchange = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> self = {},
      timeout_id,
      iframe,
      set_history,
      get_history;</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Initialize. In IE 6/7, creates a hidden Iframe for history handling.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Most browsers don’t need special methods here..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      set_history = get_history = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
        <span class="hljs-keyword">return</span> val;
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>But IE6/7 do!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (is_old_ie) {</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Create hidden Iframe after the end of the body to prevent initial
page load from scrolling unnecessarily.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        iframe = $(<span class="hljs-string">'&lt;iframe src="javascript:0"/&gt;'</span>).hide().insertAfter(<span class="hljs-string">'body'</span>)[<span class="hljs-number">0</span>].contentWindow;</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Get history by looking at the hidden Iframe’s location.hash.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        get_history = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">return</span> get_fragment(iframe.document[str_location][str_href]);
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Set a new history item by opening and then closing the Iframe
document, <em>then</em> setting its location.hash.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        set_history = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hash, history_hash</span>) </span>{
          <span class="hljs-keyword">if</span> (hash !== history_hash) {
            <span class="hljs-keyword">var</span> doc = iframe.document;
            doc.open().close();
            doc[str_location].hash = <span class="hljs-string">'#'</span> + hash;
          }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Set initial history.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        set_history(get_fragment());
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Start the polling loop.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.start = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Polling loop is already running!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (timeout_id) {
        <span class="hljs-keyword">return</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Remember the initial hash so it doesn’t get triggered immediately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> last_hash = get_fragment();</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Initialize if not yet initialized.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      set_history || init();</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>This polling loop checks every $.hashchangeDelay milliseconds to see if
location.hash has changed, and triggers the ‘hashchange’ event on
window when necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loopy</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> hash = get_fragment(),
          history_hash = get_history(last_hash);

        <span class="hljs-keyword">if</span> (hash !== last_hash) {
          set_history(last_hash = hash, history_hash);

          $(<span class="hljs-built_in">window</span>).trigger(str_hashchange);

        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (history_hash !== last_hash) {
          <span class="hljs-built_in">window</span>[str_location][str_href] = <span class="hljs-built_in">window</span>[str_location][str_href].replace(<span class="hljs-regexp">/#.*/</span>, <span class="hljs-string">''</span>) + <span class="hljs-string">'#'</span> + history_hash;
        }

        timeout_id = setTimeout(loopy, $[str_hashchange + <span class="hljs-string">'Delay'</span>]);
      })();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Stop the polling loop, but only if an IE6/7 Iframe wasn’t created. In
that case, even if there are no longer any bound event handlers, the
polling loop is still necessary for back/next to work at all!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    self.stop = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (!iframe) {
        timeout_id &amp;&amp; clearTimeout(timeout_id);
        timeout_id = <span class="hljs-number">0</span>;
      }
    };

    <span class="hljs-keyword">return</span> self;
  })();

})(jQuery, <span class="hljs-keyword">this</span>);

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">"function"</span> &amp;&amp; define.amd) {
  define([<span class="hljs-string">"jquery"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$</span>) </span>{});
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
